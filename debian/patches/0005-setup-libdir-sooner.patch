Description: Setup libdir sooner in setup.py
 Without this patch, setup.py fails because self.slurm_lib is None.
Author: RÃ©mi Palancher <remi-externe.palancher@edf.fr>
Forwarded: no
Last-Update: 2022-03-01

diff --git a/setup.py b/setup.py
index 9238ae7..99501d6 100644
--- a/setup.py
+++ b/setup.py
@@ -237,30 +237,6 @@ class Pyslurm:
         # Clean up temporary build objects first
         self.clean()
 
-        args = sys.argv[1:]
-        for arg in args:
-            if arg.find("--slurm=") == 0:
-                self.slurm_dir = arg.split("=")[1]
-                sys.argv.remove(arg)
-            if arg.find("--slurm-lib=") == 0:
-                self.slurm_lib = arg.split("=")[1]
-                sys.argv.remove(arg)
-            if arg.find("--slurm-inc=") == 0:
-                self.slurm_inc = arg.split("=")[1]
-                sys.argv.remove(arg)
-
-        # Slurm installation directory
-        if self.slurm_dir and (self.slurm_lib or self.slurm_inc):
-            self.usage()
-        elif self.slurm_dir and not (self.slurm_lib or self.slurm_inc):
-            self.slurm_lib = self.slurm_dir
-            self.slurm_inc = self.slurm_dir+"/include"
-        elif not self.slurm_dir and not self.slurm_lib and not self.slurm_inc:
-            self.slurm_lib = self.default_slurm_dir
-            self.slurm_inc = self.default_slurm_dir+"/include"
-        elif not self.slurm_dir and (not self.slurm_lib or not self.slurm_inc):
-            self.usage()
-
         # Test for slurm.h maybe from derived paths
         if os.path.exists(self.slurm_inc+"/slurm/slurm.h"):
             info("Build - Found Slurm header in %s /slurm" % (self.slurm_inc))
@@ -298,6 +274,29 @@ class Pyslurm:
         if len(args) == 0:
             self.usage()
         else:
+            for arg in args:
+                if arg.find("--slurm=") == 0:
+                    self.slurm_dir = arg.split("=")[1]
+                    sys.argv.remove(arg)
+                if arg.find("--slurm-lib=") == 0:
+                    self.slurm_lib = arg.split("=")[1]
+                    sys.argv.remove(arg)
+                if arg.find("--slurm-inc=") == 0:
+                    self.slurm_inc = arg.split("=")[1]
+                    sys.argv.remove(arg)
+
+            # Slurm installation directory
+            if self.slurm_dir and (self.slurm_lib or self.slurm_inc):
+                 self.usage()
+            elif self.slurm_dir and not (self.slurm_lib or self.slurm_inc):
+                self.slurm_lib = self.slurm_dir
+                self.slurm_inc = self.slurm_dir+"/include"
+            elif not self.slurm_dir and not self.slurm_lib and not self.slurm_inc:
+                self.slurm_lib = self.default_slurm_dir
+                self.slurm_inc = self.default_slurm_dir+"/include"
+            elif not self.slurm_dir and (not self.slurm_lib or not self.slurm_inc):
+                self.usage()
+
             if "--bgq" in args:
                 self.bgq = 1
 
